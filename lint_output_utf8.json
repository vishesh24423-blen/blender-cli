[{"filePath":"D:\\blender-github-api\\blenderlab\\app\\api\\submit-job\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\app\\job\\[jobId]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isQueued'. Either include it or remove the dependency array.","line":52,"column":8,"nodeType":"ArrayExpression","endLine":52,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [isQueued, job, jobId]","fix":{"range":[2040,2052],"text":"[isQueued, job, jobId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { use, useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { collection, query, where, getDocs, orderBy } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { useJob } from '@/hooks/useJob';\r\nimport { useRunner } from '@/hooks/useRunner';\r\nimport { useCountdown } from '@/hooks/useCountdown';\r\nimport QueuePosition from '@/components/QueuePosition';\r\nimport FileDownloadCard from '@/components/FileDownloadCard';\r\nimport Link from 'next/link';\r\nimport { ArrowLeft, RefreshCw, AlertTriangle } from 'lucide-react';\r\nimport type { OutputFormat } from '@/lib/types';\r\n\r\nexport default function JobPage({ params }: { params: Promise<{ jobId: string }> }) {\r\n    const { jobId } = use(params);\r\n    const router = useRouter();\r\n    const { job, loading, error } = useJob(jobId);\r\n    const { runner } = useRunner();\r\n    const nextRunCountdown = useCountdown(runner?.nextRunAt);\r\n    const [queuePosition, setQueuePosition] = useState<number | null>(null);\r\n    const isQueued = job?.status === 'queued';\r\n\r\n    // Reset position if no longer queued (sync in render to avoid lint error)\r\n    if (!isQueued && queuePosition !== null) {\r\n        setQueuePosition(null);\r\n    }\r\n\r\n    // Calculate queue position\r\n    useEffect(() => {\r\n        if (!isQueued) return;\r\n\r\n        const fetchPosition = async () => {\r\n            try {\r\n                const q = query(\r\n                    collection(db, 'jobs'),\r\n                    where('status', '==', 'queued'),\r\n                    orderBy('createdAt', 'asc')\r\n                );\r\n                const snap = await getDocs(q);\r\n                const position = snap.docs.findIndex((d) => d.id === jobId) + 1;\r\n                setQueuePosition(position > 0 ? position : 1);\r\n            } catch {\r\n                setQueuePosition(null);\r\n            }\r\n        };\r\n\r\n        fetchPosition();\r\n        const interval = setInterval(fetchPosition, 10000);\r\n        return () => clearInterval(interval);\r\n    }, [job, jobId]);\r\n\r\n    const handleRetry = () => {\r\n        router.push('/');\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"loading-page\">\r\n                <div className=\"loading-spinner-lg\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error || !job) {\r\n        return (\r\n            <div className=\"job-page\">\r\n                <Link href=\"/\" className=\"back-link\">\r\n                    <ArrowLeft size={16} /> Back to home\r\n                </Link>\r\n                <div className=\"status-card\">\r\n                    <div className=\"status-card-center\">\r\n                        <AlertTriangle size={40} color=\"var(--accent-red)\" />\r\n                        <p className=\"processing-text\">{error || 'Job not found'}</p>\r\n                        <Link href=\"/\" className=\"retry-button\">\r\n                            <ArrowLeft size={16} /> Go back\r\n                        </Link>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"job-page\">\r\n            <Link href=\"/\" className=\"back-link\">\r\n                <ArrowLeft size={16} /> Back to home\r\n            </Link>\r\n\r\n            <div className=\"job-page-header\">\r\n                <p className=\"job-id\">Job ID: {jobId}</p>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '16px', flexWrap: 'wrap' }}>\r\n                    <h1 className=\"job-title\">Job Status</h1>\r\n                    <span className={`status-badge status-badge--${job.status}`}>\r\n                        {job.status}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* ΓöÇΓöÇΓöÇ Queued ΓöÇΓöÇΓöÇ */}\r\n            {job.status === 'queued' && (\r\n                <div className=\"status-card glow-purple\">\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                        {queuePosition !== null && <QueuePosition position={queuePosition} />}\r\n\r\n                        {runner && runner.status === 'inactive' && (\r\n                            <div style={{\r\n                                padding: '16px 20px',\r\n                                borderRadius: 'var(--radius-sm)',\r\n                                background: 'var(--accent-yellow-dim)',\r\n                                border: '1px solid rgba(245, 158, 11, 0.2)',\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                gap: '4px'\r\n                            }}>\r\n                                <span style={{ fontSize: '14px', fontWeight: 500 }}>\r\n                                    ΓÅ│ Runner is idle\r\n                                </span>\r\n                                <span style={{ fontSize: '13px', color: 'var(--text-muted)' }}>\r\n                                    Next activation in: <strong style={{ color: 'var(--text-primary)', fontFamily: 'var(--font-mono)' }}>{nextRunCountdown.formatted}</strong>\r\n                                </span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {runner && runner.status === 'active' && (\r\n                            <div style={{\r\n                                padding: '16px 20px',\r\n                                borderRadius: 'var(--radius-sm)',\r\n                                background: 'var(--accent-green-dim)',\r\n                                border: '1px solid rgba(16, 185, 129, 0.2)',\r\n                            }}>\r\n                                <span style={{ fontSize: '14px', color: 'var(--accent-green)' }}>\r\n                                    ≡ƒƒó Runner is active ΓÇö your job will be picked up shortly\r\n                                </span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* ΓöÇΓöÇΓöÇ Processing ΓöÇΓöÇΓöÇ */}\r\n            {job.status === 'processing' && (\r\n                <div className=\"status-card glow-purple\">\r\n                    <div className=\"status-card-center\">\r\n                        <div className=\"processing-spinner\" />\r\n                        <p className=\"processing-text\">Blender is running your script...</p>\r\n                        <p className=\"processing-sub\">\r\n                            This usually takes 30 seconds to a few minutes depending on complexity\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* ΓöÇΓöÇΓöÇ Done ΓöÇΓöÇΓöÇ */}\r\n            {job.status === 'done' && (\r\n                <div className=\"downloads-section\">\r\n                    <h2 className=\"downloads-title\">Your 3D Models are Ready</h2>\r\n                    <div className=\"downloads-expiry-warning\">\r\n                        <AlertTriangle size={14} />\r\n                        Files expire in 24 hours\r\n                    </div>\r\n                    <div className=\"downloads-grid\">\r\n                        {job.outputs &&\r\n                            Object.entries(job.outputs).map(([format, file]) => (\r\n                                <FileDownloadCard\r\n                                    key={format}\r\n                                    format={format as OutputFormat}\r\n                                    url={file.url}\r\n                                    size={file.size}\r\n                                />\r\n                            ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* ΓöÇΓöÇΓöÇ Failed ΓöÇΓöÇΓöÇ */}\r\n            {job.status === 'failed' && (\r\n                <div className=\"status-card\">\r\n                    <div className=\"error-section\">\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px' }}>\r\n                            <AlertTriangle size={24} color=\"var(--accent-red)\" />\r\n                            <span style={{ fontSize: '16px', fontWeight: 600 }}>Job Failed</span>\r\n                        </div>\r\n                        {job.error && <div className=\"error-message\">{job.error}</div>}\r\n                        <button className=\"retry-button\" onClick={handleRetry}>\r\n                            <RefreshCw size={16} />\r\n                            Try Again\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* ΓöÇΓöÇΓöÇ Script Preview ΓöÇΓöÇΓöÇ */}\r\n            <div className=\"script-preview\">\r\n                <div className=\"script-preview-header\">\r\n                    <span className=\"script-preview-label\">script.py</span>\r\n                    <span className=\"script-preview-label\">\r\n                        {job.formats.map((f) => `.${f}`).join(', ')}\r\n                    </span>\r\n                </div>\r\n                <pre className=\"script-preview-code\">{job.script}</pre>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\components\\FileDownloadCard.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nD:\\blender-github-api\\blenderlab\\components\\FileDownloadCard.tsx:24:24\n  22 | export default function FileDownloadCard({ format, url, size }: FileDownloadCardProps) {\n  23 |     // Assume 24 hour expiry from now (R2 signed URLs)\n> 24 |     const expiryTime = Date.now() + 24 * 60 * 60 * 1000;\n     |                        ^^^^^^^^^^ Cannot call impure function\n  25 |     const expiry = useCountdown(expiryTime);\n  26 |\n  27 |     const color = FORMAT_COLORS[format] || '#6b7280';","line":24,"column":24,"nodeType":null,"endLine":24,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useCountdown } from '@/hooks/useCountdown';\r\nimport { formatFileSize } from '@/lib/utils';\r\nimport type { OutputFormat } from '@/lib/types';\r\nimport { Download, Clock, FileBox } from 'lucide-react';\r\n\r\ninterface FileDownloadCardProps {\r\n    format: OutputFormat;\r\n    url: string;\r\n    size: number;\r\n}\r\n\r\nconst FORMAT_COLORS: Record<string, string> = {\r\n    glb: '#10b981',\r\n    fbx: '#8b5cf6',\r\n    stl: '#f59e0b',\r\n    obj: '#3b82f6',\r\n    usd: '#ec4899',\r\n};\r\n\r\nexport default function FileDownloadCard({ format, url, size }: FileDownloadCardProps) {\r\n    // Assume 24 hour expiry from now (R2 signed URLs)\r\n    const expiryTime = Date.now() + 24 * 60 * 60 * 1000;\r\n    const expiry = useCountdown(expiryTime);\r\n\r\n    const color = FORMAT_COLORS[format] || '#6b7280';\r\n\r\n    return (\r\n        <div className=\"download-card\" style={{ '--accent': color } as React.CSSProperties}>\r\n            <div className=\"download-card-header\">\r\n                <div className=\"download-card-icon\" style={{ background: `${color}20`, color }}>\r\n                    <FileBox size={24} />\r\n                </div>\r\n                <div className=\"download-card-meta\">\r\n                    <span className=\"download-card-format\">.{format.toUpperCase()}</span>\r\n                    <span className=\"download-card-size\">{formatFileSize(size)}</span>\r\n                </div>\r\n            </div>\r\n\r\n            <a\r\n                href={url}\r\n                download\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"download-card-button\"\r\n                style={{ background: color }}\r\n            >\r\n                <Download size={16} />\r\n                Download\r\n            </a>\r\n\r\n            <div className=\"download-card-expiry\">\r\n                <Clock size={12} />\r\n                <span>Expires in ~{expiry.formatted}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\components\\QueuePosition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\components\\RunnerStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\components\\ScriptSubmitForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\hooks\\useCountdown.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\hooks\\useJob.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\hooks\\useRunner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\scripts\\persistent_worker.js","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":22,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":4,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":4,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":5,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":5,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":40,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":69,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\scripts\\set_runner_status.js","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\blender-github-api\\blenderlab\\scripts\\upload_r2.js","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":58,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":87,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":43,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":83,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":4,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":4,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
